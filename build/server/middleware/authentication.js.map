{"version":3,"sources":["middleware/authentication.js"],"names":["authenticate","params","redirectUrl","message","error","req","res","next","User","require","model","authCookie","cookies","err","sub","findOne","_id","userData","redirect","module","exports"],"mappings":";;AAAA;;AACA;;AACA;;;;;;AAEA,SAASA,YAAT,GAA6E;AAAA,MAAvDC,MAAuD,uEAA9C,EAAEC,aAAa,GAAf,EAAoBC,SAAS,EAA7B,EAAiCC,OAAO,EAAxC,EAA8C;;AAC3E,SAAO,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACzB,QAAMC,OAAOC,QAAQ,UAAR,EAAoBC,KAApB,CAA0B,MAA1B,CAAb;AACA,QAAMC,aAAaN,IAAIO,OAAJ,CAAY,UAAZ,CAAnB;AACA,QAAID,UAAJ,EAAgB;AACd,4BAAOA,UAAP,EAAmB,gBAAM,YAAN,CAAnB,EAAwC,UAACE,GAAD,EAAMC,GAAN,EAAc;AACpD,YAAID,GAAJ,EAAS,OAAON,KAAKM,GAAL,CAAP;AACTL,aAAKO,OAAL,CAAa,EAAEC,KAAKF,GAAP,EAAb,EAA2B,UAACD,GAAD,EAAMI,QAAN,EAAmB;AAC5C,cAAIJ,GAAJ,EAAS;AACP,mCAAWR,GAAX,EAAgB,OAAhB,EAAyBJ,OAAOG,KAAhC;AACA,mCAAWC,GAAX,EAAgB,SAAhB,EAA2BJ,OAAOE,OAAlC;AACA,mBAAOG,IAAIY,QAAJ,CAAajB,OAAOC,WAApB,CAAP;AACD;AACD,iBAAOK,MAAP;AACD,SAPD;AAQD,OAVD;AAWD,KAZD,MAYO;AACL,6BAAWF,GAAX,EAAgB,OAAhB,EAAyBJ,OAAOG,KAAhC;AACA,6BAAWC,GAAX,EAAgB,SAAhB,EAA2BJ,OAAOE,OAAlC;AACA,aAAOG,IAAIY,QAAJ,CAAajB,OAAOC,WAApB,CAAP;AACD;AACF,GApBD;AAqBD;;AAEDiB,OAAOC,OAAP,GAAiBpB,YAAjB","file":"authentication.js","sourcesContent":["import { verify } from '../utils/jwtUtils';\nimport { flashWrite } from '../utils';\nimport sData from '../sData';\n\nfunction authenticate(params = { redirectUrl: '/', message: '', error: '' }) {\n  return (req, res, next) => {\n    const User = require('mongoose').model('User');\n    const authCookie = req.cookies['auth.loc'];\n    if (authCookie) {\n      verify(authCookie, sData['jwt-secret'], (err, sub) => {\n        if (err) return next(err);\n        User.findOne({ _id: sub }, (err, userData) => {\n          if (err) {\n            flashWrite(req, 'error', params.error);\n            flashWrite(req, 'message', params.message);\n            return res.redirect(params.redirectUrl);\n          }\n          return next();\n        });\n      });\n    } else {\n      flashWrite(req, 'error', params.error);\n      flashWrite(req, 'message', params.message);\n      return res.redirect(params.redirectUrl);\n    }\n  };\n}\n\nmodule.exports = authenticate;\n"]}